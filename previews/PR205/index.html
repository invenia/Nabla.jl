<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · Nabla.jl</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="assets/indigo.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.png" alt="Nabla.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">Nabla.jl</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href="index.html">Home</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Getting-Started"><span>Getting Started</span></a></li><li><a class="tocitem" href="#A-Toy-Problem"><span>A Toy Problem</span></a></li><li><a class="tocitem" href="#High-Level-Interface"><span>High-Level Interface</span></a></li><li><a class="tocitem" href="#Low-Level-Interface"><span>Low-Level Interface</span></a></li><li><a class="tocitem" href="#Gotchas-and-Best-Practice"><span>Gotchas and Best Practice</span></a></li></ul></li><li><a class="tocitem" href="pages/api.html">API</a></li><li><a class="tocitem" href="pages/custom.html">Custom Sensitivities</a></li><li><a class="tocitem" href="pages/autodiff.html">Details</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="index.html">Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/invenia/Nabla.jl/blob/master/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Nabla"><a class="docs-heading-anchor" href="#Nabla">Nabla</a><a id="Nabla-1"></a><a class="docs-heading-anchor-permalink" href="#Nabla" title="Permalink"></a></h1><p><a href="https://travis-ci.org/invenia/Nabla.jl"><img src="https://travis-ci.org/invenia/Nabla.jl.svg?branch=master" alt="Build Status"/></a> <a href="https://ci.appveyor.com/project/iamed2/nabla-jl/branch/master"><img src="https://ci.appveyor.com/api/projects/status/g0gun5dxbkt631am/branch/master?svg=true" alt="Windows Build status"/></a> <a href="https://codecov.io/github/invenia/Nabla.jl?branch=master"><img src="https://codecov.io/github/invenia/Nabla.jl/coverage.svg?branch=master" alt="codecov.io"/></a> <a href="https://invenia.github.io/Nabla.jl/stable"><img src="https://img.shields.io/badge/docs-stable-blue.svg" alt="Stable Docs"/></a> <a href="https://invenia.github.io/Nabla.jl/latest"><img src="https://img.shields.io/badge/docs-latest-blue.svg" alt="Latest Docs"/></a></p><h1 id="Getting-Started"><a class="docs-heading-anchor" href="#Getting-Started">Getting Started</a><a id="Getting-Started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-Started" title="Permalink"></a></h1><p><code>Nabla.jl</code> has two interfaces, both of which we expose to the end user. We first provide a minimal working example with the high-level interface, and subsequently show how the low-level interface can be used to achieve similar results. More involved examples can be found <a href="https://github.com/invenia/Nabla.jl/tree/master/examples">here</a>.</p><h2 id="A-Toy-Problem"><a class="docs-heading-anchor" href="#A-Toy-Problem">A Toy Problem</a><a id="A-Toy-Problem-1"></a><a class="docs-heading-anchor-permalink" href="#A-Toy-Problem" title="Permalink"></a></h2><p>Consider the gradient of a vector-quadratic function. The following code snippet constructs such a function, and inputs <code>x</code> and <code>y</code>.</p><pre><code class="language- hljs">using Nabla

# Generate some data.
rng, N = MersenneTwister(123456), 2
x, y = randn.(rng, [N, N])
A = randn(rng, N, N)

# Construct a vector-quadratic function in `x` and `y`.
f(x, y) = y&#39; * (A * x)
f(x, y)</code></pre><p>Only a small amount of <a href="https://en.wikipedia.org/wiki/Matrix_calculus">matrix calculus</a> is required to the find the gradient of <code>f(x, y)</code> w.r.t. <code>x</code> and <code>y</code>, which we denote by <code>∇x</code> and <code>∇y</code> respectively, to be</p><pre><code class="language- hljs">(∇x, ∇y) = (A&#39;y, A * x)</code></pre><h2 id="High-Level-Interface"><a class="docs-heading-anchor" href="#High-Level-Interface">High-Level Interface</a><a id="High-Level-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#High-Level-Interface" title="Permalink"></a></h2><p>The high-level interface provides a simple way to &quot;just get the gradients&quot; w.r.t. each argument of <code>f</code>:</p><pre><code class="language- hljs">∇x, ∇y = ∇(f)(x, y)</code></pre><p>This interface is implemented in <code>core.jl</code>, and is a thin wrapper of the low-level interface constructed above. Here, we first use <code>∇</code> to get a function which, when evaluated, returns the gradient of <code>f</code> w.r.t. each of it&#39;s inputs at the values of the inputs provided.</p><p>We may provide an optional argument to also return the value <code>f(x, y)</code>:</p><pre><code class="language- hljs">(z, (∇x, ∇y)) = ∇(f; get_output=true)(x, y)</code></pre><p>If the gradient w.r.t. a single argument is all that is required, or a subset of the arguments for an N-ary function, we recommend closing over the arguments which respect to which you do not wish to take gradients. For example, to take the gradient w.r.t. just <code>x</code>, one could do the following:</p><pre><code class="language- hljs">∇(x-&gt;f(x, y))(x)</code></pre><p>Note that this returns a 1-tuple containing the result, not the result itself!</p><p>Furthermore, indexable containers such as <code>Dict</code>s behave sensibly. For example, the following lambda with a <code>Dict</code>:</p><pre><code class="language- hljs">∇(d-&gt;f(d[:x], d[:y]))(Dict(:x=&gt;x, :y=&gt;y))</code></pre><p>or a <code>Vector</code>:</p><pre><code class="language- hljs">∇(v-&gt;f(v[1], v[2]))([x, y])</code></pre><p>The methods considered so far have been completely generically typed. If one wishes to use methods whose argument types are restricted then one must surround the definition of the method in the <code>@unionise</code> macro. For example, if only a single definition is required:</p><pre><code class="language-julia hljs">@unionise g(x::Real) = ...</code></pre><p>Alternatively, if multiple methods / functions are to be defined, the following format is recommended:</p><pre><code class="language-julia hljs">@unionise begin
g(x::Real) = ...
g(x::T, y::T) where T&lt;:Real = ...
foo(x) = ... # This definition is unaffected by `@unionise`.
end</code></pre><p><code>@unionise</code> simply changes the method signature to allow each argument to accept the union of the types specified and <code>Nabla.jl</code>&#39;s internal <code>Node</code> type. This will have no impact on the performance of your code when arguments of the types specified in the definition are provided, so you can safely <code>@unionise</code> code without worrying about potential performance implications.</p><h2 id="Low-Level-Interface"><a class="docs-heading-anchor" href="#Low-Level-Interface">Low-Level Interface</a><a id="Low-Level-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Low-Level-Interface" title="Permalink"></a></h2><p>We now use <code>Nabla.jl</code>&#39;s low-level interface to take the gradient of <code>f</code> w.r.t. <code>x</code> and <code>y</code> at the values of <code>x</code> and <code>y</code> generated above. We first place <code>x</code> and <code>y</code> into a <code>Leaf</code> container. This enables these variables to be traced by <code>Nabla.jl</code>. This can be achieved by first creating a <code>Tape</code> object, onto which all computations involving <code>x</code> and <code>y</code> are recorded, as follows:</p><pre><code class="language-julia hljs">tape = Tape()
x_ = Leaf(tape, x)
y_ = Leaf(tape, y)</code></pre><p>which can be achieved more concisely using Julia&#39;s broadcasting capabilities:</p><pre><code class="language- hljs">x_, y_ = Leaf.(Tape(), (x, y))</code></pre><p>Note that it is critical that <code>x_</code> and <code>y_</code> are constructed using the same <code>Tape</code> instance. Currently, <code>Nabla.jl</code> will fail silently if this is not the case. We then simply pass <code>x_</code> and <code>y_</code> to <code>f</code> instead of <code>x</code> and <code>y</code>:</p><pre><code class="language- hljs">z_ = f(x_, y_)</code></pre><p>We can compute the gradients of <code>z_</code> w.r.t. <code>x_</code> and <code>y_</code> using <code>∇</code>, and access them by indexing the output with <code>x_</code> and <code>y_</code>:</p><pre><code class="language- hljs">∇z = ∇(z_)
(∇x, ∇y) = (∇z[x_], ∇z[y_])</code></pre><h2 id="Gotchas-and-Best-Practice"><a class="docs-heading-anchor" href="#Gotchas-and-Best-Practice">Gotchas and Best Practice</a><a id="Gotchas-and-Best-Practice-1"></a><a class="docs-heading-anchor-permalink" href="#Gotchas-and-Best-Practice" title="Permalink"></a></h2><ul><li><code>Nabla.jl</code> does not currently have complete coverage of the entire standard library due to finite resources and competing priorities. Particularly notable omissions are the subtypes of <code>Factorization</code> objects and all in-place functions. These are both issues which will be resolved in the future.</li><li>The usual RMAD gotcha applies: due to the need to record each of the operations performed in the execution of a function for use in efficient gradient computation, the memory requirement of a programme scales approximately linearly in the length of the programme. Although, due to our use of a dynamically constructed computation graph, we support all forms of control flow, long <code>for</code> / <code>while</code> loops should be performed with care, so as to avoid running out of memory.</li><li>In a similar vein, develop a (strong) preference for higher-order functions and linear algebra over for-loops; <code>Nabla.jl</code> has optimisations targetting Julia&#39;s higher-order functions (<code>broadcast</code>, <code>mapreduce</code> and friends), and consequently loop-fusion / &quot;dot-syntax&quot;, and linear algebra operations which should be made use of where possible.</li></ul></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="pages/api.html">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.5 on <span class="colophon-date" title="Tuesday 27 July 2021 14:26">Tuesday 27 July 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
